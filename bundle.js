!function(t){var e={};function r(n){if(e[n])return e[n].exports;var i=e[n]={i:n,l:!1,exports:{}};return t[n].call(i.exports,i,i.exports,r),i.l=!0,i.exports}r.m=t,r.c=e,r.d=function(t,e,n){r.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},r.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)r.d(n,i,function(e){return t[e]}.bind(null,i));return n},r.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="",r(r.s=1)}([function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.getFileData=function(t){return new Promise(function(e,r){var n=new FileReader;n.addEventListener("load",function(){e(n.result)},!1),n.readAsArrayBuffer(t)})},e.paletteToRGBA=function(t,e){for(var r=new Uint8Array(4*t.length),n=t.length,i=0;i<n;++i)r[4*i]=e[3*t[i]],r[4*i+1]=e[3*t[i]+1],r[4*i+2]=e[3*t[i]+2],r[4*i+3]=255;return r},e.paletteWithLastTransToRGBA=function(t,e){for(var r=new Uint8Array(4*t.length),n=t.length,i=0;i<n;++i)255===t[i]?r[4*i+3]=0:(r[4*i]=e[3*t[i]],r[4*i+1]=e[3*t[i]+1],r[4*i+2]=e[3*t[i]+2],r[4*i+3]=255);return r}},function(t,e,r){t.exports=r(2)},function(t,e,r){"use strict";var n=this&&this.__awaiter||function(t,e,r,n){return new(r||(r=Promise))(function(i,a){function o(t){try{u(n.next(t))}catch(t){a(t)}}function s(t){try{u(n.throw(t))}catch(t){a(t)}}function u(t){t.done?i(t.value):new r(function(e){e(t.value)}).then(o,s)}u((n=n.apply(t,e||[])).next())})},i=this&&this.__generator||function(t,e){var r,n,i,a,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(a){return function(s){return function(a){if(r)throw new TypeError("Generator is already executing.");for(;o;)try{if(r=1,n&&(i=2&a[0]?n.return:a[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,a[1])).done)return i;switch(n=0,i&&(a=[2&a[0],i.value]),a[0]){case 0:case 1:i=a;break;case 4:return o.label++,{value:a[1],done:!1};case 5:o.label++,n=a[1],a=[0];continue;case 7:a=o.ops.pop(),o.trys.pop();continue;default:if(!(i=(i=o.trys).length>0&&i[i.length-1])&&(6===a[0]||2===a[0])){o=0;continue}if(3===a[0]&&(!i||a[1]>i[0]&&a[1]<i[3])){o.label=a[1];break}if(6===a[0]&&o.label<i[1]){o.label=i[1],i=a;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(a);break}i[2]&&o.ops.pop(),o.trys.pop();continue}a=e.call(t,o)}catch(t){a=[6,t],n=0}finally{r=i=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,s])}}},a=this;Object.defineProperty(e,"__esModule",{value:!0});var o=r(3),s=r(0);window.onload=function(){var t=document.querySelector("input");t.onchange=function(){return n(a,void 0,void 0,function(){var e,r,n,a;return i(this,function(i){switch(i.label){case 0:return[4,s.getFileData(t.files[0])];case 1:return e=i.sent(),r=o.Sprite.parse(e),console.log(r.header),console.log(r.frames),n=document.querySelector("canvas"),a=n.getContext("2d"),function(t,e){var r=0,n=0;e.forEach(function(t){r+=t.height,n=n>t.width?n:t.width}),t.width=n,t.height=r}(n,r.frames),function(t,e){var r=0;e.frames.forEach(function(e){for(var n=t.createImageData(e.width,e.height),i=e.data.length,a=0;a<i;a++)n.data[a]=e.data[a];t.putImageData(n,0,r),r+=e.height})}(a,r),[2]}})})}}},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n,i=r(0),a=r(4);!function(t){t[t.VP_PARALLEL_UPRIGHT=0]="VP_PARALLEL_UPRIGHT",t[t.FACING_UPRIGHT=1]="FACING_UPRIGHT",t[t.VP_PARALLEL=2]="VP_PARALLEL",t[t.ORIENTED=3]="ORIENTED",t[t.VP_PARALLEL_ORIENTED=4]="VP_PARALLEL_ORIENTED"}(e.SpriteType||(e.SpriteType={})),function(t){t[t.SPR_NORMAL=0]="SPR_NORMAL",t[t.SPR_ADDITIVE=1]="SPR_ADDITIVE",t[t.SPR_INDEXALPHA=2]="SPR_INDEXALPHA",t[t.SPR_ALPHTEST=3]="SPR_ALPHTEST"}(n=e.SpriteAlphaType||(e.SpriteAlphaType={})),function(t){t[t.SYNCHRONIZED=0]="SYNCHRONIZED",t[t.RANDOM=1]="RANDOM"}(e.SpriteSyncType||(e.SpriteSyncType={}));var o=function(){function t(t,e){this.header=t,this.frames=e}return t.parse=function(e){var r=new a.Reader(e);if("IDSP"!==r.nstr(4))throw new Error("Invalid sprite file format");for(var o={version:r.i(),type:r.i(),alphaType:r.i(),radius:r.f(),width:r.i(),height:r.i(),frameCount:r.i(),beamLength:r.f(),syncType:r.i()},s=r.s(),u=r.arrx(3*s,a.ReaderDataType.UByte),f=[],h=0;h<o.frameCount;++h){var l={group:r.i(),position:[r.i(),r.i()],width:r.i(),height:r.i(),data:new Uint8Array(o.width*o.height*4)},c=r.arrx(o.width*o.height,a.ReaderDataType.UByte);o.alphaType===n.SPR_ALPHTEST?l.data=i.paletteWithLastTransToRGBA(c,u):l.data=i.paletteToRGBA(c,u),f.push(l)}return new t(o,f)},t}();e.Sprite=o},function(t,e,r){"use strict";var n;Object.defineProperty(e,"__esModule",{value:!0}),function(t){t[t.UByte=0]="UByte",t[t.Byte=1]="Byte",t[t.UShort=2]="UShort",t[t.Short=3]="Short",t[t.UInt=4]="UInt",t[t.Int=5]="Int",t[t.Float=6]="Float",t[t.Double=7]="Double",t[t.NString=8]="NString",t[t.String=9]="String"}(n=e.ReaderDataType||(e.ReaderDataType={}));var i=function(){function t(t){if(0===t.byteLength)throw new Error("ArrayBuffer must have size greater than zero");this.data=new DataView(t),this.offset=0}return t.prototype.length=function(){return this.data.byteLength},t.prototype.tell=function(){return this.offset},t.prototype.seek=function(t){this.offset=Math.max(0,t)},t.prototype.skip=function(t){this.seek(this.tell()+t)},t.prototype.b=function(){var t=this.data.getInt8(this.offset);return this.skip(1),t},t.prototype.ub=function(){var t=this.data.getUint8(this.offset);return this.skip(1),t},t.prototype.s=function(t){void 0===t&&(t=!0);var e=this.data.getInt16(this.offset,t);return this.skip(2),e},t.prototype.us=function(t){void 0===t&&(t=!0);var e=this.data.getUint16(this.offset,t);return this.skip(2),e},t.prototype.i=function(t){void 0===t&&(t=!0);var e=this.data.getInt32(this.tell(),t);return this.skip(4),e},t.prototype.ui=function(t){void 0===t&&(t=!0);var e=this.data.getUint32(this.tell(),t);return this.skip(4),e},t.prototype.f=function(t){void 0===t&&(t=!0);var e=this.data.getFloat32(this.tell(),t);return this.skip(4),e},t.prototype.lf=function(t){void 0===t&&(t=!0);var e=this.data.getFloat64(this.tell(),t);return this.skip(8),e},t.prototype.str=function(){for(var t=this.ub(),e="";0!==t;)e+=String.fromCharCode(t),t=this.ub();return e},t.prototype.nstr=function(t){if(t<0)throw new Error("Invalid string length");for(var e="";t>0;){t-=1;var r=this.ub();if(0===r)break;e+=String.fromCharCode(r)}return 0!==t&&this.skip(t),e},t.prototype.arr=function(t,e){e.bind(this);for(var r=[];t-- >0;)r.push(e());return r},t.prototype.arrx=function(t,e,r){var i;switch(void 0===r&&(r=0),e){case n.UByte:i=new Uint8Array(this.data.buffer,this.tell(),t),this.skip(t);break;case n.Byte:i=new Int8Array(this.data.buffer,this.tell(),t),this.skip(t);break;case n.UShort:i=new Uint16Array(this.data.buffer,this.tell(),t),this.skip(2*t);break;case n.Short:i=new Int16Array(this.data.buffer,this.tell(),t),this.skip(2*t);break;case n.UInt:i=new Uint32Array(this.data.buffer,this.tell(),t),this.skip(4*t);break;case n.Int:i=new Int32Array(this.data.buffer,this.tell(),t),this.skip(4*t);break;case n.Float:i=new Float32Array(this.data.buffer,this.tell(),t),this.skip(4*t);break;case n.Double:i=new Float64Array(this.data.buffer,this.tell(),t),this.skip(8*t);break;case n.NString:for(i=[];t-- >0;)i.push(i.nstr(r));break;case n.String:for(i=[];t-- >0;)i.push(i.str())}return i},t}();e.Reader=i}]);